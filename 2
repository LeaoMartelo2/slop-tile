#include "../raylib/raylib.h"
#include "player.hpp"
#include "scene.hpp"
#include "tilemap.hpp"

int main() {

    const int screen_width = 800;
    const int screen_height = 600;

    SetConfigFlags(FLAG_VSYNC_HINT);
    InitWindow(screen_width, screen_height, "turn down for what");
    SetTargetFPS(60);

    SceneManager scene_manager;

    float tile_size = 32.0f;
    TileMap tilemap(35, 10, tile_size);
    Scene *main_scene = new Scene(tilemap);

    scene_manager.add_scene(main_scene);

    Vector2 start_pos = {tile_size * 1.5f, tile_size * 1.5f};
    float player_speed = 500.0f;

    Player player(&tilemap, start_pos, player_speed, {32, 64}, main_scene->get_camera());

    tilemap.surround_map(WALL);

    tilemap.set_tile(5, 5, WALL);
    tilemap.set_tile(5, 6, WALL);
    tilemap.set_tile(6, 5, WALL);

    while (!WindowShouldClose()) {

        float dt = GetFrameTime();

        scene_manager.scenes[0]->draw_scene();
        scene_manager.scenes[0]->update_scene();

        // DrawText(TextFormat("%f, %f", player.get_position().x, player.get_position().y),
        //        player.get_position().x + 30, player.get_position().y + 20, 20, WHITE);

        EndMode2D();

        EndDrawing();
    }

    CloseWindow();

    return 0;
}
